<!DOCTYPE html> 
<html lang="en">
    <head>
        <title>player lookup</title>
        <meta charset="utf-8"/>
        <meta name="author" content="Andrew Heath" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <!--CSS -->

        <link rel="stylesheet" href="https://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.min.css">
        <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="CSS/Main.css"/>
    </head>
    <body>

        <div class="row">
            <div class="columns small-1"> </div>
            <div class="columns small-11">
                <nav aria-label="You are here:" role="navigation">
                    <ul class="breadcrumbs">
                        <li><a href="../index.html">Home</a></li>
                        <li>
                            <span class="show-for-sr">Current: </span> Player Look up tool 
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
        <hr>
        <form>
            <div class="row">

                <div class="columns small-6"><input type="text" placeholder="Input team URL here" id="TeamURL"></div>
                <div class="columns small-3"> <button type="button" class="button success" onclick="getInputValue();">Submit</button></div>
                <div class="columns small-3"><div id='loader'><img src="ajax-loader.gif"/></div></div>
            </div>
        </form>
        <hr>
        https://www.nse.gg/universities/university-of-leeds/teams/leads-rainbow-six-siege/
        <div class="row">
            <div class="columns small-12">
                <table>
                    <thead>
                        <th width="400">Username</th>
                        <th width="400">Rank</th>
                        <th width="400">Link to profile</th>
                    </thead>
                    <tbody>
                        <tr>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>

        <script src="https://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.js"></script>
        <script>

            //Creates a dummy html element so that we can append the rest of the html onto it and use dom to find elements
            var Dummy = document.createElement('html');
            var PlayerProfile;

            $('#loader').hide();//Hides the loader gif 

            //deprecated sleep function, can probs delete
            function sleep(milliseconds) {
                const date = Date.now();
                let currentDate = null;
                do {
                    currentDate = Date.now();
                } while (currentDate - date < milliseconds);
            }
            //takes value from text box and passes to the Get NSE data function
            function getInputValue(){
                // Selecting the input element and get its value 
                var inputVal = document.getElementById("TeamURL").value;

                GetNSEdata(inputVal);
            }
            function GetNSEdata(TeamURL){
                //https://www.nse.gg/universities/university-of-leeds/teams/leads-rainbow-six-siege/

                // uses all origins to get around cors
                var url = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(TeamURL);

                $.ajax({
                    beforeSend: function(){$('#loader').show();},
                    async: false,
                    type: 'GET',
                    url: url,
                    success: function(response) {
                        //console.log(response);
                        var responseText = response.replace(/img/gi,'<noload'); //removes any images so the dont attempt to be loaded
                        Dummy.innerHTML = responseText; //adds the Repsonse text to the Dummy element so that it can be manipulated
                       
                        $('#loader').hide();
                    }
                });         
                //creates a collection for the player Usernames
                PlayerName = Dummy.getElementsByClassName('moniker padding-b8');
                //Coolection of PlayerProfile Urls
                PlayerProfile = Dummy.getElementsByClassName('team-member-footer');

                //declaring the Username Array
                var PlayerNameText = [];
                var PlayerProfileURLS = [];
                //populating array with Data from the Player name collection 
                for( var i = 0; i < PlayerName.length; i++){
                    PlayerNameText[i]  = PlayerName[i].textContent;
                }
                for(var i = 0; i<PlayerProfile.length; i++){
                    PlayerProfileURLS[i] = PlayerProfile[i].querySelector('a').getAttribute('href');
                }
                for( var i = 0; i < PlayerName.length; i++){
                    $("table").append('<tr><td>'+ PlayerNameText[i]+'</td><td></td><td></td></tr> ')
                }
                    
                    
//                //these loops just output the two arrays
//                for( var i = 0; i < PlayerProfileURLS.length; i++){
//                    console.log(PlayerProfileURLS[i]);
//                }
//                for( var i = 0; i < PlayerName.length; i++){
//                    console.log(PlayerNameText[i]);
//                }
            }

        </script>
        <script>
            $(document).foundation();

        </script>
    </body>
</html>    
